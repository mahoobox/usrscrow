<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
  </head>
  <body>
    
    <button id="conectar-button">Conectar Wallet Metamask</button>
    <!--BOTÓN DE TRASNFERENCIA DE PRUEBA
    <button id="transferencia-button">Transferencia</button>
    <button id="conexion-button">Conectar al contrato</button>-->
    <label for="cars">Stablecoin en venta:</label>

    <select name="plan" id="inputToken">
                <option value="none" selected disabled hidden>Stablecoin en venta:</option>
                <option value="0xA2025B15a1757311bfD68cb14eaeFCc237AF5b43">USDC (...5b43)</option>
                <option value="0xC2C527C0CACF457746Bd31B2a698Fe89de2b6d49">USDT (...6d49) </option>
                <option value="0xa7c3Bf25FFeA8605B516Cf878B7435fe1768c89b">BUSD (...c89b) </option>
                <option value="0x75Ab5AB1Eef154C0352Fc31D2428Cef80C7F8B33">DAI (...8B33) </option>
            </select>
    <label name="inputAmountToken">Unidades a comercializar:</label>
    <input type="number" id="inputAmountToken" name="inputAmountToken" placeholder="Unidades a comercializar">
    <label name="inputComisions">Comisión 0.1%:</label>
    <input type="number" name="inputComision" id="inputComision" placeholder="Comisión 0.1%" disabled>
    <label name="inputTotalScrow">Total a depositar en Escrow:</label>
    <input type="number" name="inputTotalScrow" id="inputTotalScrow" placeholder="Total Escrow" disabled>
    <label name="inputTotalScrowWEI" style="display:none">Total a depositar en Escrow (en WEI):</label>
    <input type="number" name="inputTotalScrowWEI" id="inputTotalScrowWEI" placeholder="Total Scrow en WEI" style="display:none">
    <p id="confirmacionAprobar"></p> 
    <button id="aprobar-button">Aprobar Uso de Tokens</button>
    
    <input type="text" id="inputSeller" placeholder="Dirección que recibirá los tokens aprobados"> 
    <label name="inputIDTransaccion">ID único para su transacción:</label>
    <input type="number" name="inputIDTransaccion" id="inputIDTransaccion" value=""> 
    <p id="confirmacionEnvio"></p> 
    <button id="envio-tokens-button">Envío Tokens al SmartContract</button>

    <label name="inputIDTransaccionLiberar">ID de transacción a liberar:</label>
    <input type="number" name="inputIDTransaccionLiberar" id="inputIDTransaccionLiberar" placeholder="ID de transacción a liberar">
    <p id="confirmacionRelease"></p> 
    <button id="release-button">Finalizar Escrow</button>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var input = document.querySelector("input[name=inputAmountToken]");
        input.addEventListener('keyup', function() {
            var content1Input = document.querySelector("input[name=inputComision]");
            content1Input.value = this.value*0.1/100;
        });
        input.addEventListener('keyup', function() {
            var content2Input = document.querySelector("input[name=inputTotalScrow]");
            content2Input.value = Number(this.value)+Number(this.value*0.1/100);
        });
        input.addEventListener('keyup', function() {
            var content3Input = document.querySelector("input[name=inputTotalScrowWEI]");
            content3Input.value = (Number(this.value)+Number(this.value*0.1/100))* 10 ** 6;
        });


    });

    function random() {
        var content4Input = document.querySelector("input[name=inputIDTransaccion]");
        valorDefecto = document.getElementById("inputIDTransaccion").innerHTML = Math.floor(Math.random() * 100000);
        content4Input.value = valorDefecto
    }

    window.onload = random;

    //document.getElementById("inputIDTransaccion").innerHTML = Number(Math.floor(Math.random() * 100));
    




    let account;
    let direccionToken = document.getElementById("inputToken").value;
    let cantidadAprobada = document.getElementById("inputTotalScrowWEI").value;
    let direccionDestino = document.getElementById("inputSeller").value;
    let idTransaccion = document.getElementById("inputIDTransaccion").value;

    // INICIO CONECTAR ******************************************************************************************************************************
    document.getElementById('conectar-button').addEventListener('click', event => {
        let button = event.target;
        ethereum.request({method: 'eth_requestAccounts'}).then(accounts => {
            account = accounts[0];
            console.log(account);
            button.textContent = account;

            ethereum.request({method: 'eth_getBalance' , params: [account, 'latest']}).then(result => {
            console.log(result);
            let wei = parseInt(result,16);
            let balance = wei / (10**18);
            console.log(balance + " ETH");
            });
        });
    });


    // INICIO TRANSFERENCIA  DE PRUEBA******************************************************************************************************************************
    /*
    document.getElementById('transferencia-button').addEventListener('click', event =>{
        let transactionParam = {
        to: '0xaaD6a099d23CB7ECff75a37389D5bdcb06E6Dabf',
        from: account,
        value: '0x38D7EA4C68000'
        };
        console.log(account);
        
        ethereum.request({method: 'eth_sendTransaction', params:[transactionParam]}).then(txhash => {
        console.log(txhash);
        checkTransactionconfirmation(txhash).then(r => alert(r));
        });
    });
   

    // INICIO CONEXIÓN A CONTRATO ******************************************************************************************************************************
    document.getElementById('conexion-button').addEventListener('click', event =>{
        let button = event.target;
        const connectContract = async () => {
            const ABI = [
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "EscrowCancelResolved",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "orderId",
                            "type": "uint256"
                        },
                        {
                            "components": [
                                {
                                    "internalType": "address payable",
                                    "name": "buyer",
                                    "type": "address"
                                },
                                {
                                    "internalType": "address payable",
                                    "name": "seller",
                                    "type": "address"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "value",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "sellerfee",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "buyerfee",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "contract IERC20",
                                    "name": "currency",
                                    "type": "address"
                                },
                                {
                                    "internalType": "enum PaydeceEscrow.EscrowStatus",
                                    "name": "status",
                                    "type": "uint8"
                                }
                            ],
                            "indexed": false,
                            "internalType": "struct PaydeceEscrow.Escrow",
                            "name": "escrow",
                            "type": "tuple"
                        }
                    ],
                    "name": "EscrowComplete",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "orderId",
                            "type": "uint256"
                        },
                        {
                            "components": [
                                {
                                    "internalType": "address payable",
                                    "name": "buyer",
                                    "type": "address"
                                },
                                {
                                    "internalType": "address payable",
                                    "name": "seller",
                                    "type": "address"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "value",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "sellerfee",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "buyerfee",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "contract IERC20",
                                    "name": "currency",
                                    "type": "address"
                                },
                                {
                                    "internalType": "enum PaydeceEscrow.EscrowStatus",
                                    "name": "status",
                                    "type": "uint8"
                                }
                            ],
                            "indexed": false,
                            "internalType": "struct PaydeceEscrow.Escrow",
                            "name": "escrow",
                            "type": "tuple"
                        }
                    ],
                    "name": "EscrowDeposit",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "EscrowDisputeResolved",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "previousOwner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "newOwner",
                            "type": "address"
                        }
                    ],
                    "name": "OwnershipTransferred",
                    "type": "event"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_addressStableToWhitelist",
                            "type": "address"
                        }
                    ],
                    "name": "addStablesAddresses",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "cancelEscrow",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        },
                        {
                            "internalType": "address payable",
                            "name": "_seller",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_value",
                            "type": "uint256"
                        },
                        {
                            "internalType": "contract IERC20",
                            "name": "_currency",
                            "type": "address"
                        }
                    ],
                    "name": "createEscrow",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_addressStableToWhitelist",
                            "type": "address"
                        }
                    ],
                    "name": "delStablesAddresses",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "refundBuyer",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "releaseEscrow",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "releaseEscrowOwner",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "renounceOwnership",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_feeBuyer",
                            "type": "uint256"
                        }
                    ],
                    "name": "setFeeBuyer",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_feeSeller",
                            "type": "uint256"
                        }
                    ],
                    "name": "setFeeSeller",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "newOwner",
                            "type": "address"
                        }
                    ],
                    "name": "transferOwnership",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "contract IERC20",
                            "name": "_currency",
                            "type": "address"
                        }
                    ],
                    "name": "withdrawFees",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "escrows",
                    "outputs": [
                        {
                            "internalType": "address payable",
                            "name": "buyer",
                            "type": "address"
                        },
                        {
                            "internalType": "address payable",
                            "name": "seller",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "value",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "sellerfee",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "buyerfee",
                            "type": "uint256"
                        },
                        {
                            "internalType": "contract IERC20",
                            "name": "currency",
                            "type": "address"
                        },
                        {
                            "internalType": "enum PaydeceEscrow.EscrowStatus",
                            "name": "status",
                            "type": "uint8"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "feeBuyer",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "contract IERC20",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "feesAvailable",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "feeSeller",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "getState",
                    "outputs": [
                        {
                            "internalType": "enum PaydeceEscrow.EscrowStatus",
                            "name": "",
                            "type": "uint8"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_orderId",
                            "type": "uint256"
                        }
                    ],
                    "name": "getValue",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "owner",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "version",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "pure",
                    "type": "function"
                }
            ];
            const Address = "0x1126281AD8af558186FCd930267a149252da57e1";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);
          

            const data = await window.contract.methods.getAddress().call();
            //document.getElementById("contractAccount").innerHTML = `Contract Account: ${data}`;
            button.textContent = "Conectado al contrato " + data;
            console.log("conectado al contrato")
        }
        connectContract();
    });
     */


    // INICIO APROBAR USO DE TOKENS A CONTRATO ******************************************************************************************************************************
    document.getElementById('aprobar-button').addEventListener('click', event =>{
        let button = event.target;
        direccionToken = document.getElementById("inputToken").value;
        cantidadAprobada = document.getElementById("inputTotalScrowWEI").value;
        const connectContract = async () => {
            
            try {
                await window.ethereum.enable();

                // Obtén la dirección del contrato
                const contractAddressNO = '0xA2025B15a1757311bfD68cb14eaeFCc237AF5b43'; //USDC
                const parametr = '0x1126281AD8af558186FCd930267a149252da57e1'; //CONTRATO PAYDECEESCROW

                const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "allowance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

                window.web3 = await new Web3(window.ethereum);
                window.contract = await new window.web3.eth.Contract(contractABI, direccionToken);

                const result = await window.contract.methods.approve(parametr,cantidadAprobada).send({from: account});

                console.log(result);
                document.getElementById("confirmacionAprobar").innerHTML = "Transacción Aprobada: " + result["transactionHash"];
            } catch (error) {
                console.error(error);
            }
            

        }
        connectContract();
    });


    // INICIO ENVÍO DE TOKENS A CONTRATO ******************************************************************************************************************************
    document.getElementById('envio-tokens-button').addEventListener('click', event =>{
        let button = event.target;
        direccionDestino = document.getElementById("inputSeller").value;
        idTransaccion = document.getElementById("inputIDTransaccion").value;
        const enviarToContract = async () => {
            
            try {
                await window.ethereum.enable();

                // Obtén la dirección del contrato
                const contractAddress = '0x1126281AD8af558186FCd930267a149252da57e1'; //CONTRATO PAYDECEESCROW

                const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			}
		],
		"name": "EscrowCancelResolved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "address payable",
						"name": "buyer",
						"type": "address"
					},
					{
						"internalType": "address payable",
						"name": "seller",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "value",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "sellerfee",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "buyerfee",
						"type": "uint256"
					},
					{
						"internalType": "contract IERC20",
						"name": "currency",
						"type": "address"
					},
					{
						"internalType": "enum PaydeceEscrow.EscrowStatus",
						"name": "status",
						"type": "uint8"
					}
				],
				"indexed": false,
				"internalType": "struct PaydeceEscrow.Escrow",
				"name": "escrow",
				"type": "tuple"
			}
		],
		"name": "EscrowComplete",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "address payable",
						"name": "buyer",
						"type": "address"
					},
					{
						"internalType": "address payable",
						"name": "seller",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "value",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "sellerfee",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "buyerfee",
						"type": "uint256"
					},
					{
						"internalType": "contract IERC20",
						"name": "currency",
						"type": "address"
					},
					{
						"internalType": "enum PaydeceEscrow.EscrowStatus",
						"name": "status",
						"type": "uint8"
					}
				],
				"indexed": false,
				"internalType": "struct PaydeceEscrow.Escrow",
				"name": "escrow",
				"type": "tuple"
			}
		],
		"name": "EscrowDeposit",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			}
		],
		"name": "EscrowDisputeResolved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_addressStableToWhitelist",
				"type": "address"
			}
		],
		"name": "addStablesAddresses",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "cancelEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			},
			{
				"internalType": "address payable",
				"name": "_seller",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_value",
				"type": "uint256"
			},
			{
				"internalType": "contract IERC20",
				"name": "_currency",
				"type": "address"
			}
		],
		"name": "createEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_addressStableToWhitelist",
				"type": "address"
			}
		],
		"name": "delStablesAddresses",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "refundBuyer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "releaseEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "releaseEscrowOwner",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_feeBuyer",
				"type": "uint256"
			}
		],
		"name": "setFeeBuyer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_feeSeller",
				"type": "uint256"
			}
		],
		"name": "setFeeSeller",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC20",
				"name": "_currency",
				"type": "address"
			}
		],
		"name": "withdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "escrows",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "buyer",
				"type": "address"
			},
			{
				"internalType": "address payable",
				"name": "seller",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "sellerfee",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "buyerfee",
				"type": "uint256"
			},
			{
				"internalType": "contract IERC20",
				"name": "currency",
				"type": "address"
			},
			{
				"internalType": "enum PaydeceEscrow.EscrowStatus",
				"name": "status",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feeBuyer",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"name": "feesAvailable",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feeSeller",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "getState",
		"outputs": [
			{
				"internalType": "enum PaydeceEscrow.EscrowStatus",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "getValue",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "version",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	}
];

                window.web3 = await new Web3(window.ethereum);
                window.contract = await new window.web3.eth.Contract(contractABI, contractAddress);

                let _orderId = idTransaccion;
                let _seller = direccionDestino;
                let _value = cantidadAprobada;
                let _currency = direccionToken;

                const result = await window.contract.methods.createEscrow(_orderId,_seller,_value,_currency).send({from: account});

                console.log(result);
                document.getElementById("confirmacionEnvio").innerHTML = "Transacción Aprobada: " + result["transactionHash"];
            } catch (error) {
                console.error(error);
            }
            

        }
        enviarToContract();
    });


    // INICIO LIBERAR TOKENS DE CONTRATO ******************************************************************************************************************************
    document.getElementById('release-button').addEventListener('click', event =>{
        let button = event.target;
        let idTransaccion = document.getElementById("inputIDTransaccionLiberar").value;
        const releaseContract = async () => {
            
            try {
                await window.ethereum.enable();

                // Obtén la dirección del contrato
                const contractAddress = '0x1126281AD8af558186FCd930267a149252da57e1'; //CONTRATO PAYDECEESCROW

                const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			}
		],
		"name": "EscrowCancelResolved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "address payable",
						"name": "buyer",
						"type": "address"
					},
					{
						"internalType": "address payable",
						"name": "seller",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "value",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "sellerfee",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "buyerfee",
						"type": "uint256"
					},
					{
						"internalType": "contract IERC20",
						"name": "currency",
						"type": "address"
					},
					{
						"internalType": "enum PaydeceEscrow.EscrowStatus",
						"name": "status",
						"type": "uint8"
					}
				],
				"indexed": false,
				"internalType": "struct PaydeceEscrow.Escrow",
				"name": "escrow",
				"type": "tuple"
			}
		],
		"name": "EscrowComplete",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "address payable",
						"name": "buyer",
						"type": "address"
					},
					{
						"internalType": "address payable",
						"name": "seller",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "value",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "sellerfee",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "buyerfee",
						"type": "uint256"
					},
					{
						"internalType": "contract IERC20",
						"name": "currency",
						"type": "address"
					},
					{
						"internalType": "enum PaydeceEscrow.EscrowStatus",
						"name": "status",
						"type": "uint8"
					}
				],
				"indexed": false,
				"internalType": "struct PaydeceEscrow.Escrow",
				"name": "escrow",
				"type": "tuple"
			}
		],
		"name": "EscrowDeposit",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "orderId",
				"type": "uint256"
			}
		],
		"name": "EscrowDisputeResolved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_addressStableToWhitelist",
				"type": "address"
			}
		],
		"name": "addStablesAddresses",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "cancelEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			},
			{
				"internalType": "address payable",
				"name": "_seller",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_value",
				"type": "uint256"
			},
			{
				"internalType": "contract IERC20",
				"name": "_currency",
				"type": "address"
			}
		],
		"name": "createEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_addressStableToWhitelist",
				"type": "address"
			}
		],
		"name": "delStablesAddresses",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "refundBuyer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "releaseEscrow",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "releaseEscrowOwner",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_feeBuyer",
				"type": "uint256"
			}
		],
		"name": "setFeeBuyer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_feeSeller",
				"type": "uint256"
			}
		],
		"name": "setFeeSeller",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC20",
				"name": "_currency",
				"type": "address"
			}
		],
		"name": "withdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "escrows",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "buyer",
				"type": "address"
			},
			{
				"internalType": "address payable",
				"name": "seller",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "sellerfee",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "buyerfee",
				"type": "uint256"
			},
			{
				"internalType": "contract IERC20",
				"name": "currency",
				"type": "address"
			},
			{
				"internalType": "enum PaydeceEscrow.EscrowStatus",
				"name": "status",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feeBuyer",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"name": "feesAvailable",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feeSeller",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "getState",
		"outputs": [
			{
				"internalType": "enum PaydeceEscrow.EscrowStatus",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_orderId",
				"type": "uint256"
			}
		],
		"name": "getValue",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "version",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	}
];

                window.web3 = await new Web3(window.ethereum);
                window.contract = await new window.web3.eth.Contract(contractABI, contractAddress);

                let _orderId = idTransaccion;

                const result = await window.contract.methods.releaseEscrow(_orderId).send({from: account});

                console.log(result);
                document.getElementById("confirmacionRelease").innerHTML = "Transacción Aprobada: " + result["transactionHash"];
            } catch (error) {
                console.error(error);
            }
            

        }
        releaseContract();
    });


    // INICIO COMISION DE CONTRATO ******************************************************************************************************************************

     
    document.addEventListener('DOMContentLoaded', function() {
    var input = document.getElementById("select[name=inputToken]");
    input.addEventListener('keyup', function() {
        var content1Input = document.querySelector("input[name=inputComision]");
        content1Input.value = this.value;
    });
    });



    </script>  
  </body>
</html>
